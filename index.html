<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>mqray's blog</title><meta name="author" content="mqray"><meta name="copyright" content="mqray"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="明日复明日，明日何其多？">
<meta property="og:type" content="website">
<meta property="og:title" content="mqray&#39;s blog">
<meta property="og:url" content="https://mqrayblog.cn/index.html">
<meta property="og:site_name" content="mqray&#39;s blog">
<meta property="og:description" content="明日复明日，明日何其多？">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://mqrayblog.cn/img/avatar.png">
<meta property="article:author" content="mqray">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://mqrayblog.cn/img/avatar.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://mqrayblog.cn/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: mqray","link":"链接: ","source":"来源: mqray's blog","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'mqray\'s blog',
  isPost: false,
  isHome: true,
  isHighlightShrink: false,
  isToc: false,
  postUpdate: '2023-08-07 23:58:00'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="mqray's blog" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">12</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">2</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">1</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><span> 首页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><span> 编程</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/java/"><span> java</span></a></li><li><a class="site-page child" href="/categories/go/"><span> go</span></a></li><li><a class="site-page child" href="/categories/python/"><span> python</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw database"></i><span> 数据库</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/mysql/"><span> mysql</span></a></li><li><a class="site-page child" href="/categories/mongo/"><span> mongo</span></a></li><li><a class="site-page child" href="/categories/redis/"><span> redis</span></a></li><li><a class="site-page child" href="/categories/clickhouse/"><span> clickhouse</span></a></li><li><a class="site-page child" href="/categories/es/"><span> es</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw middleware"></i><span> 中间件</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/kafka/"><span> kafka</span></a></li><li><a class="site-page child" href="/categories/pulsar/"><span> pulsar</span></a></li><li><a class="site-page child" href="/categories/rocketmq/"><span> rockectmq</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw native cloud"></i><span> 云原生</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/docker/"><span> docker</span></a></li><li><a class="site-page child" href="/categories/k8s/"><span> k8s</span></a></li><li><a class="site-page child" href="/categories/linux/"><span> linux</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw source"></i><span> 源码阅读</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/redis/"><span> redis</span></a></li><li><a class="site-page child" href="/categories/kafka/"><span> kafka</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw more"></i><span> 更多</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/sth/"><span> 随笔</span></a></li><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></li></ul></div></div></div></div><div class="page" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog-info"><a href="/" title="mqray's blog"><span class="site-name">mqray's blog</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><span> 首页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><span> 编程</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/java/"><span> java</span></a></li><li><a class="site-page child" href="/categories/go/"><span> go</span></a></li><li><a class="site-page child" href="/categories/python/"><span> python</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw database"></i><span> 数据库</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/mysql/"><span> mysql</span></a></li><li><a class="site-page child" href="/categories/mongo/"><span> mongo</span></a></li><li><a class="site-page child" href="/categories/redis/"><span> redis</span></a></li><li><a class="site-page child" href="/categories/clickhouse/"><span> clickhouse</span></a></li><li><a class="site-page child" href="/categories/es/"><span> es</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw middleware"></i><span> 中间件</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/kafka/"><span> kafka</span></a></li><li><a class="site-page child" href="/categories/pulsar/"><span> pulsar</span></a></li><li><a class="site-page child" href="/categories/rocketmq/"><span> rockectmq</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw native cloud"></i><span> 云原生</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/docker/"><span> docker</span></a></li><li><a class="site-page child" href="/categories/k8s/"><span> k8s</span></a></li><li><a class="site-page child" href="/categories/linux/"><span> linux</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw source"></i><span> 源码阅读</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/redis/"><span> redis</span></a></li><li><a class="site-page child" href="/categories/kafka/"><span> kafka</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw more"></i><span> 更多</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/sth/"><span> 随笔</span></a></li><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav></header><main class="layout" id="content-inner"><div class="recent-posts" id="recent-posts"><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/2023/08/07/redis%E4%B9%8B%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/" title="redis之主从复制">redis之主从复制</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-08-07T15:13:18.000Z" title="发表于 2023-08-07 23:13:18">2023-08-07</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/redis/">redis</a></span></div><div class="content">主从模式主从结构是常用的计算机系统架构，通常被用于分布式系统中，其中一个节点master拥有最新的数据，其他节点slave复制并同步主节点的数据。  
主从结构中，主节点负责写入数据，并将这些数据同步到从节点中；从节点只能读取数据。主从节点键通过网络连接，完成数据同步。  
主从模式也常被用于数据库系统中，提供高可用能力。当主节点发生故障或者失效时，从节点可以被选举为新的主节点，保证系统的可用性。 
  

主从模式的优点
负载均衡：读写分离：提高服务器的性能。
数据冗余：主从复制实现了数据的热备份，是持久化之外的数据冗余手段。
高可用基石：主从模式是哨兵模式和集群模式的基础。

主从模式的缺点？
主从模式不具备自动容错和恢复功能，主节点故障，集群无法工作，可用性较低。从节点升为主节点需要人工手动干预。

什么是主从模式？为什么redis要使用主从模式？主从模式的优缺点？如何使用主从复制？slave of ip port该命令的作用？
复制过程？旧版本复制功能的实现？同步?命令传播？全量复制过程？redis 2.8之前?
sync
旧版本复制的缺陷？新版本复制功能的实现？2.8之后
全 ...</div></div></div><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/2023/08/05/redis%E4%B9%8B%E5%AE%A2%E6%88%B7%E7%AB%AF/" title="redis之客户端">redis之客户端</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-08-05T10:13:32.000Z" title="发表于 2023-08-05 18:13:32">2023-08-05</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/redis/">redis</a></span></div><div class="content">redis服务器是典型的一对多服务器程序，一个服务器可以和多个客户端建立网络请求，每个客户端可以向服务器发送命令请求，服务器接收并处理客户端发送的命令请求，并向客户端返回命令回复。通过使用由IO多路复用技术实现的文件事件处理器，redis服务器使用单线程单进程的方式处理命令请求，并与多个客户端进行网络通信。6.0之后，IO多路复用处使用多线程实现。与服务器建立连接的客户端将以链表的形式被保存在redisServer中：
123struct redisServer &#123;    list *clients;  // 链表保存各客户端状态&#125;

客户端属性客户端状态包含的属性可以分为两类：

比较通用的属性，无论客户端执行什么工作，都需要使用这些属性
和特定功能相关的属性，比如操作数据库时需要用到的db属性和dictid属性，执行时需要用到mstate属性等。

id123typedef struct client &#123;     uint64_t id; // 自增客户端唯一id&#125;
flags123typedef struct client &#123;   ...</div></div></div><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/2023/07/31/redis%E4%B9%8B%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8/" title="redis之事件驱动">redis之事件驱动</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-07-31T04:54:32.000Z" title="发表于 2023-07-31 12:54:32">2023-07-31</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/redis/">redis</a><span class="article-meta-link">•</span><a class="article-meta__tags" href="/tags/%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/">源码阅读</a></span></div><div class="content">引言redis服务器是一个事件驱动程序，服务器需要处理两类事件：

文件事件处理器：redis基于reactor模式开发的网络事件处理器。
事件事件处理器： 比如serverCron函数，需要在给定的时间点执行。

文件事件处理器使用io多路复用来同时监听多个套接字，并根据套接字目前执行的任务为套接字关联不同的事件处理器。当被监听的套接字准备好执行连接应答、读取、写入、关闭等操作时，与之操作相对应的文件事件就会产生，这些文件事件就会调用套接字关联的事件处理器处理这些事件。
事件处理流程

server.c mainredis服务端主线程中定义有如下代码：
12345678910int main(int argc, char **argv) &#123;    ...    initServer(); // 创建、初始化服务端数据结构，    ...    initListeners(); // 初始化服务器后，初始化监听器    ...    aeMain(server.el); // 启动 事件循环    aeDeleteEventLoop(server.el); // 服务器关闭时 ...</div></div></div><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/2023/07/27/redis%E4%B9%8Bio/" title="redis之io">redis之io</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-07-27T07:05:26.000Z" title="发表于 2023-07-27 15:05:26">2023-07-27</time></span></div><div class="content"></div></div></div><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/2023/07/27/c%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80%E5%87%BD%E6%95%B0%E6%95%B4%E7%90%86/" title="c语言基础函数整理">c语言基础函数整理</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-07-27T04:37:53.000Z" title="发表于 2023-07-27 12:37:53">2023-07-27</time></span></div><div class="content">阅读redis源码过程中有比较多的C语言函数调用，起一个文档记录。
fflush刷新流stream的输出缓冲区，成功返回0，否则返回eof
1int fflush(FILE *stream)

fopen1FILE *fopen(char *filename, char *mode);

fclose用于关闭一个已经打开的文件。关闭文件后，该文件的指针将不再指向该文件，文件的缓冲区中的数据将被写入到磁盘中，文件的描述符将被释放，以便其他程序可以使用该文件。
1int fclose(FILE *stream);

fileno获取标准IO流的文件描述符。
1int fileno(FILE *stream);


unlink删除文件。PS: 执行unlink()函数并不一定会真正的删除文件，它先会检查文件系统中此文件的连接数是否为1，如果不是1说明此文件还有其他链接对象，因此只对此文件的连接数进行减1操作。若连接数为1，并且在此时没有任何进程打开该文件，此内容才会真正地被删除掉。
1int unlink(const char *pathname);



snprintf用于格式化输出字 ...</div></div></div><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/2023/07/24/redis%E4%B9%8B%E6%8C%81%E4%B9%85%E5%8C%96/" title="redis之持久化">redis之持久化</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-07-24T14:45:02.000Z" title="发表于 2023-07-24 22:45:02">2023-07-24</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/redis/">redis</a><span class="article-meta-link">•</span><a class="article-meta__tags" href="/tags/%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/">源码阅读</a></span></div><div class="content">由于redis是内存数据库，其数据库状态保存在内存中。redis中提供了持久化功能，用以将redis内存中的数据库状态保存在磁盘中，避免意外的数据丢失。
Redis中提供了两种持久化方式，分别是RDB和AOF。
RDBRDB持久化功能可以将某个时间点上的数据库状态保存到一个RDB文件中，所生成的RDB文件是一个经过压缩的二进制文件，通过该文件可以还原生成RDB文件时的数据库状态。
RDB文件载入rdb文件的载入工作是在服务器启动时自动执行的。因为aof文件的更新频率通常比rdb文件的更新频率高，所以如果服务器开启了AOF持久化功能，服务器将优先使用AOF文件来还原数据库状态。只有在AOF持久化功能处于关闭时，服务器才会使用rdb文件来还原数据库状态。
另外，在服务器载入rdb文件期间，会一直处于阻塞状态，直到载入完毕。
RDB文件创建redis中可以使用SAVE和BGSAVE两个命令生成RDB文件。其中，save命令会阻塞服务器进程，直到RDB文件创建完毕位置，在此期间，服务器不能处理任何命令请求。而BGSAVE命令则会派生出一个子进程，由子进程负责创建RDB文件，服务器主进程可以继续 ...</div></div></div><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/2023/07/23/redis%E4%B9%8B%E6%9C%8D%E5%8A%A1%E5%99%A8/" title="redis之服务器">redis之服务器</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-07-23T14:44:39.000Z" title="发表于 2023-07-23 22:44:39">2023-07-23</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/redis/">redis</a><span class="article-meta-link">•</span><a class="article-meta__tags" href="/tags/%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/">源码阅读</a></span></div><div class="content">redis服务器redis服务器负责与多个客户端建立网络连接，处理客户端请求，在数据库中保存客户端执行命令所产生的数据，并通过资源管理来维持服务器的自身运转。本文将应用侧和源码侧两个角度进行描述。

服务器的功能：redis客户端发送命令后，服务器如何处理；
服务器源码结构中相关重要参数。

redis架构详解单机模式主从模式哨兵模式集群模式慢查询日志redis的慢查询日志功能用于记录执行时间超过设定时长的命令请求，用户可以通过这个功能那个产生的日志来监控和优化查询。服务器配置中包含如下两个和慢查询有关的参数：

slowlog-log-slower-than： 执行时长超过多少微秒时，将命令记录到慢查询日志中；如果&#x3D;0，则表示将存储所有执行的日志。
slowlog-max-length： 指定服务器能保存多少条慢查询日志。

redisServer属性众多，现在来看下和慢查询相关的属性：
123456struct redisServer &#123;    list *slowlog;                  /* SLOWLOG list of commands ...</div></div></div><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/2023/07/21/redis%E4%B9%8B%E7%89%B9%E6%AE%8A%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/" title="redis之特殊数据类型">redis之特殊数据类型</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-07-20T17:26:45.000Z" title="发表于 2023-07-21 01:26:45">2023-07-21</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/redis/">redis</a></span></div><div class="content">bitmapbitmap即位图，是一种基于位运算的数据结构，用连续的二进制位描述某些业务，例如用户的签到状态等。redis中的string是二进制安全的，故而使用string来描述这个位图。相比其他数据结构，位图所占用的存储空间非常小，在上述的业务场景，使用位图更加高效。
Redis提供了SETBIT、GETBIT 、BITCOUNT 、BITOP四个命令，用于处理二进制数组
SETBIT1SETBIT key offset value 
SETBIT用于将二进制数组在偏移量位置处的二进制值设置为value，当key不存在时，会自动生成一个新的字符串值。字符串会扩展以确保可以在offset位置上设置value值，当字符串扩展时，空白位置以0填充 offset&gt;&#x3D;0， 小于512M注意对于较大的OFFSET值，命令执行过程中的内存分配可能阻塞redis服务器。
1234123.122.10.231:6379&gt; setbit bitmap 10086 1(integer) 0123.122.10.231:6379&gt; getbit bitmap 10086(int ...</div></div></div><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/2023/07/19/redis%E5%9F%BA%E7%A1%80/" title="redis之基础数据类型">redis之基础数据类型</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-07-18T17:16:20.000Z" title="发表于 2023-07-19 01:16:20">2023-07-19</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/redis/">redis</a><span class="article-meta-link">•</span><a class="article-meta__tags" href="/tags/%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/">源码阅读</a></span></div><div class="content">
redis是一个开源的、基于内存的存储结构[使用C语言编写]，通常被用于缓存、消息订阅等场景。

redis的特点

基于内存：redis借助RAM提供高速的数据访问，比磁盘要快几个量级

redis的基础数据类型
redis是键值对数据库，redis中的键均为字符串，redis中最基础的五种数据类型：string、lsit、set、zset、hashredis中使用redisObject来描述所有的key和value，redisObject的结构体定义如下：

1234567891011121314struct redisObject &#123;    // 数据类型， 占4bit    unsigned type:4;     // 编码格式 占4bit    unsigned encoding:4;    // 此对象最后一次被访问的时间 占24bit    unsigned lru:LRU_BITS; /* LRU time (relative to global lru_clock) or                            * LFU data (le ...</div></div></div><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/2023/07/15/hello-world/" title="github + hexo建站[待补充]">github + hexo建站[待补充]</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-07-15T05:32:21.739Z" title="发表于 2023-07-15 13:32:21">2023-07-15</time></span></div><div class="content">Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub.
Quick StartCreate a new post1$ hexo new &quot;My New Post&quot;

More info: Writing
Run server1$ hexo server

More info: Server
Generate static files1$ hexo generate

More info: Generating
Deploy to remote sites1$ hexo deploy

More info: Deployment
引用1. 预部署文件渲染失败解决方案2. hexo butteryfly设置  
</div></div></div><nav id="pagination"><div class="pagination"><span class="page-number current">1</span><a class="page-number" href="/page/2/#content-inner">2</a><a class="extend next" rel="next" href="/page/2/#content-inner"><i class="fas fa-chevron-right fa-fw"></i></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">mqray</div><div class="author-info__description">明日复明日，明日何其多？</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">12</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">2</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">1</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/08/07/redis%E4%B9%8B%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/" title="redis之主从复制">redis之主从复制</a><time datetime="2023-08-07T15:13:18.000Z" title="发表于 2023-08-07 23:13:18">2023-08-07</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/08/05/redis%E4%B9%8B%E5%AE%A2%E6%88%B7%E7%AB%AF/" title="redis之客户端">redis之客户端</a><time datetime="2023-08-05T10:13:32.000Z" title="发表于 2023-08-05 18:13:32">2023-08-05</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/07/31/redis%E4%B9%8B%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8/" title="redis之事件驱动">redis之事件驱动</a><time datetime="2023-07-31T04:54:32.000Z" title="发表于 2023-07-31 12:54:32">2023-07-31</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/07/27/redis%E4%B9%8Bio/" title="redis之io">redis之io</a><time datetime="2023-07-27T07:05:26.000Z" title="发表于 2023-07-27 15:05:26">2023-07-27</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/07/27/c%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80%E5%87%BD%E6%95%B0%E6%95%B4%E7%90%86/" title="c语言基础函数整理">c语言基础函数整理</a><time datetime="2023-07-27T04:37:53.000Z" title="发表于 2023-07-27 12:37:53">2023-07-27</time></div></div></div></div><div class="card-widget card-categories"><div class="item-headline">
            <i class="fas fa-folder-open"></i>
            <span>分类</span>
            
            </div>
            <ul class="card-category-list" id="aside-cat-list">
            <li class="card-category-list-item "><a class="card-category-list-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"><span class="card-category-list-name">数据库</span><span class="card-category-list-count">7</span></a></li>
            </ul></div><div class="card-widget card-tags"><div class="item-headline"><i class="fas fa-tags"></i><span>标签</span></div><div class="card-tag-cloud"><a href="/tags/redis/" style="font-size: 1.5em; color: #99a9bf">redis</a> <a href="/tags/%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/" style="font-size: 1.1em; color: #999">源码阅读</a></div></div><div class="card-widget card-archives"><div class="item-headline"><i class="fas fa-archive"></i><span>归档</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/08/"><span class="card-archive-list-date">八月 2023</span><span class="card-archive-list-count">2</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/07/"><span class="card-archive-list-date">七月 2023</span><span class="card-archive-list-count">8</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/05/"><span class="card-archive-list-date">五月 2023</span><span class="card-archive-list-count">2</span></a></li></ul></div><div class="card-widget card-webinfo"><div class="item-headline"><i class="fas fa-chart-line"></i><span>网站资讯</span></div><div class="webinfo"><div class="webinfo-item"><div class="item-name">文章数目 :</div><div class="item-count">12</div></div><div class="webinfo-item"><div class="item-name">本站访客数 :</div><div class="item-count" id="busuanzi_value_site_uv"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">本站总访问量 :</div><div class="item-count" id="busuanzi_value_site_pv"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">最后更新时间 :</div><div class="item-count" id="last-push-date" data-lastPushDate="2023-08-07T15:58:00.955Z"><i class="fa-solid fa-spinner fa-spin"></i></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2018 - 2023 By mqray</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">mqray's website</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>